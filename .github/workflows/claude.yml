name: Update README with Claude

on:
  schedule:
    - cron: '0 */12 * * *'
  workflow_dispatch:

jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Fetch recent GitHub activity
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "Fetching user profile..."
          gh api -H "Accept: application/vnd.github+json" -H "X-GitHub-Api-Version: 2022-11-28" /users/nguyenvanduocit > user_profile.json || echo '{"login":"nguyenvanduocit","name":"Developer"}' > user_profile.json

          echo "Fetching repositories..."
          gh api -H "Accept: application/vnd.github+json" -H "X-GitHub-Api-Version: 2022-11-28" "/users/nguyenvanduocit/repos?per_page=10&sort=updated" > recent_repos.json || echo '[]' > recent_repos.json

          echo "Fetching public events..."
          gh api -H "Accept: application/vnd.github+json" -H "X-GitHub-Api-Version: 2022-11-28" "/users/nguyenvanduocit/events/public?per_page=30" > recent_activity.json || echo '[]' > recent_activity.json

          echo "Data fetching complete."
          ls -la *.json

      - uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          show_full_output: true
          claude_args: |
            --allowedTools Edit,Read,Write,Bash,Glob,Grep
          prompt: |
            Analyze my recent GitHub activity and update my README.md profile.

            Read these files:
            - user_profile.json - my GitHub profile info
            - recent_activity.json - my recent public events
            - recent_repos.json - my recently updated repos
            - README.md - current profile README

            POSITIONING: I am a Pi-shaped engineer with:
            1. Deep technical expertise in backend systems and AI tooling (Go, TypeScript)
            2. Active exploration and interest in AI agents, MCP, and AI-assisted workflows
            3. Product development knowledge from shipping developer tools and learning from user feedback

            Create an updated README.md that:
            1. Opens with Pi-shaped engineer positioning (tech depth + AI interest + product sense)
            2. Frames projects as product solutions, not just technical achievements
               - Show the problem each tool solves
               - Mention user impact, adoption, or feedback where evident
            3. Highlights current work with both technical and product context
            4. Shows expertise across three dimensions:
               - Technical: backend, AI tooling, systems
               - AI exploration: agents, MCP, orchestration
               - Product: DX thinking, iteration based on usage, solving real workflow problems
            5. Maintains professional yet approachable tone
            6. Keeps it concise but shows the full Pi-shape

            Rules:
            - Never mention all-in-one-model-context-protocol or dev-kit (they are replaced by multiple mcp repos)
            - Use proper GitHub profile README markdown formatting
            - Always update the "Last updated" timestamp at the bottom of the README
            - Always commit and push the README.md after updating
            - Do not expose secrets or sensitive information
            - Show product thinking: user problems, impact, iteration, not just features
