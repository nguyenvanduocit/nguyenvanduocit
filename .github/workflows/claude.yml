name: Update README with Claude

on:
  schedule:
    - cron: '0 */12 * * *'
  workflow_dispatch:

jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Fetch recent GitHub activity
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "Fetching user profile..."
          gh api -H "Accept: application/vnd.github+json" -H "X-GitHub-Api-Version: 2022-11-28" /users/nguyenvanduocit > user_profile.json || echo '{"login":"nguyenvanduocit","name":"Developer"}' > user_profile.json

          echo "Fetching repositories..."
          gh api -H "Accept: application/vnd.github+json" -H "X-GitHub-Api-Version: 2022-11-28" "/users/nguyenvanduocit/repos?per_page=10&sort=updated" > recent_repos.json || echo '[]' > recent_repos.json

          echo "Fetching public events..."
          gh api -H "Accept: application/vnd.github+json" -H "X-GitHub-Api-Version: 2022-11-28" "/users/nguyenvanduocit/events/public?per_page=30" > recent_activity.json || echo '[]' > recent_activity.json

          echo "Data fetching complete."
          ls -la *.json

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            Analyze my recent GitHub activity and update my README.md profile.

            Read these files:
            - user_profile.json - my GitHub profile info
            - recent_activity.json - my recent public events
            - recent_repos.json - my recently updated repos
            - README.md - current profile README

            Create an updated README.md that:
            1. Introduces who I am based on activity patterns
            2. Highlights what I'm currently working on (based on recent commits/repos)
            3. Shows my areas of focus and expertise
            4. Maintains a professional yet personal tone
            5. Keeps it concise but informative

            Rules:
            - Never mention all-in-one-model-context-protocol or dev-kit (they are replaced by multiple mcp repos)
            - Use proper GitHub profile README markdown formatting
            - After generating, commit and push the README.md if there are meaningful changes
            - Do not expose secrets or sensitive information
          allowed_tools: |
            Read
            Write
            Bash(git status)
            Bash(git add)
            Bash(git commit)
            Bash(git push)
